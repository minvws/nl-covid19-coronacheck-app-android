package nl.rijksoverheid.ctr.holder.data_migration

import com.squareup.moshi.Moshi
import com.squareup.moshi.adapters.PolymorphicJsonAdapterFactory
import com.squareup.moshi.kotlin.reflect.KotlinJsonAdapterFactory
import io.mockk.every
import io.mockk.mockk
import kotlin.test.assertNotNull
import nl.rijksoverheid.ctr.api.json.Base64JsonAdapter
import nl.rijksoverheid.ctr.api.json.JsonObjectJsonAdapter
import nl.rijksoverheid.ctr.api.json.LocalDateJsonAdapter
import nl.rijksoverheid.ctr.api.json.OffsetDateTimeJsonAdapter
import nl.rijksoverheid.ctr.holder.api.OriginTypeJsonAdapter
import nl.rijksoverheid.ctr.holder.api.RemoteCouplingStatusJsonAdapter
import nl.rijksoverheid.ctr.holder.api.RemoteTestStatusJsonAdapter
import nl.rijksoverheid.ctr.holder.get_events.models.RemoteEvent
import nl.rijksoverheid.ctr.holder.paper_proof.usecases.GetEventsFromPaperProofQrUseCase
import org.junit.Test
import org.junit.runner.RunWith
import org.koin.test.AutoCloseKoinTest
import org.robolectric.RobolectricTestRunner

@RunWith(RobolectricTestRunner::class)
class DataMigrationPayloadUseCaseImplTest : AutoCloseKoinTest() {
    private val moshi = Moshi.Builder()
        .add(Base64JsonAdapter())
        .add(JsonObjectJsonAdapter())
        .add(OffsetDateTimeJsonAdapter())
        .add(LocalDateJsonAdapter())
        .add(RemoteTestStatusJsonAdapter())
        .add(OriginTypeJsonAdapter())
        .add(RemoteCouplingStatusJsonAdapter())
        .add(
            PolymorphicJsonAdapterFactory.of(
                RemoteEvent::class.java, "type"
            )
                .withSubtype(RemoteEvent.getRemoteEventClassFromType(RemoteEvent.TYPE_POSITIVE_TEST), RemoteEvent.TYPE_POSITIVE_TEST)
                .withSubtype(RemoteEvent.getRemoteEventClassFromType(RemoteEvent.TYPE_RECOVERY), RemoteEvent.TYPE_RECOVERY)
                .withSubtype(RemoteEvent.getRemoteEventClassFromType(RemoteEvent.TYPE_NEGATIVE_TEST), RemoteEvent.TYPE_NEGATIVE_TEST)
                .withSubtype(RemoteEvent.getRemoteEventClassFromType(RemoteEvent.TYPE_VACCINATION), RemoteEvent.TYPE_VACCINATION)
        )
        .add(KotlinJsonAdapterFactory())
        .build()

    private val getEventsFromPaperProofQrUseCase = mockk<GetEventsFromPaperProofQrUseCase>()
    private val dataMigrationPayloadUseCase = DataMigrationPayloadUseCaseImpl(moshi, getEventsFromPaperProofQrUseCase)

    @Test
    fun `get remoteprotocol from non dcc payload`() {
        val jsonData =
            "{\"payload\":\"eyJwcm90b2NvbFZlcnNpb24iOiIzLjAiLCJwcm92aWRlcklkZW50aWZpZXIiOiJaWloiLCJzdGF0dXMiOiJjb21wbGV0ZSIsImhvbGRlciI6eyJmaXJzdE5hbWUiOiJDb3JyaWUiLCJpbmZpeCI6InZhbiIsImxhc3ROYW1lIjoiR2VlciIsImJpcnRoRGF0ZSI6IjE5NjAtMDEtMDEifSwiZXZlbnRzIjpbeyJ0eXBlIjoicG9zaXRpdmV0ZXN0IiwidW5pcXVlIjoiZGRmNDMyYTMtNTQ2OC00ODBiLThlYWYtNzg3NDFiMWE4OTYyIiwiaXNTcGVjaW1lbiI6dHJ1ZSwicG9zaXRpdmV0ZXN0Ijp7InNhbXBsZURhdGUiOiIyMDIzLTAzLTI1VDEwOjAxWiIsInBvc2l0aXZlUmVzdWx0Ijp0cnVlLCJmYWNpbGl0eSI6IkdHRCBYTCBBbXN0ZXJkYW0iLCJ0eXBlIjoiTFA2NDY0LTQiLCJuYW1lIjoiUENSIE5hbWUiLCJtYW51ZmFjdHVyZXIiOiJQQ1IgTWFudWZhY3R1cmVyIiwiY291bnRyeSI6Ik5MIn19XX0=\",\"signature\":\"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\"}"

        val remoteProtocol = dataMigrationPayloadUseCase.parsePayload(jsonData.toByteArray())

        assertNotNull(remoteProtocol)
    }

    @Test
    fun `get remoteprotocol from dcc payload`() {
        val jsonData =
            "{\"couplingCode\":\"ZKGBKH\",\"credential\":\"HC1:NCFC20490T9WTWGVLKS79 1VYLTXZM8AVX*4FBBU42*70J+9DN03E54F3/Y1LOCY50.FK8ZKO/EZKEZ967L6C56GVC*JC1A6C%63W5Y96746TPCBEC7ZKW.CC9DCECS34\$ CXKEW.CAWEV+A3+9K09GY8 JC2/DSN83LEQEDMPCG/DY-CB1A5IAVY87:EDOL9WEQDD+Q6TW6FA7C466KCN9E%961A6DL6FA7D46.JCP9EJY8L/5M/5546.96VF6.JCBECB1A-:8\$966469L6OF6VX6FVCPD0KQEPD0LVC6JD846Y96*963W5.A6UPCBJCOT9+EDL8FHZ95/D QEALEN44:+C%69AECAWE:34: CJ.CZKE9440/D+34S9E5LEWJC0FD3%4AIA%G7ZM81G72A6J+9SG77N91R6E+9LCBMIBQCAYM8UIB51A9Y9AF6WA6I4817S6ZKH/C3*F*\$GR4N2+5F8FM B\$W6KU91A9WTO8S1QK87DBBMHDKFT*UMNCI3V\$LS.QFWMF18W6TH5\$9W+4QZLU71.5DB73000FGWU/0CRF\"}"
        every { getEventsFromPaperProofQrUseCase.get(any()) } returns mockk()

        val remoteProtocol = dataMigrationPayloadUseCase.parsePayload(jsonData.toByteArray())

        assertNotNull(remoteProtocol)
    }
}
